<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrainWave Disorder Detection</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }

        .input-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .input-section {
                grid-template-columns: 1fr;
            }
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            margin-bottom: 10px;
            color: #555;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }

        .file-input {
            position: absolute;
            left: -9999px;
        }

        .file-input-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 15px;
            border: 3px dashed #667eea;
            border-radius: 15px;
            background: #f8f9ff;
            color: #667eea;
            font-weight: 600;
            transition: all 0.3s ease;
            min-height: 60px;
        }

        .file-input-button:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .text-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            font-size: 1rem;
            transition: all 0.3s ease;
            resize: vertical;
            min-height: 100px;
        }

        .text-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            margin-top: 30px;
        }

        .prediction-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
        }

        .prediction-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .prediction-result {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .confidence-score {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .signal-display {
            width: 100%;
            height: 300px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .status-info {
            background: #e3f2fd;
            color: #1976d2;
            border-left: 4px solid #2196f3;
        }

        .status-success {
            background: #e8f5e8;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .status-error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #f44336;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .probability-bars {
            margin-top: 20px;
        }

        .probability-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .probability-label {
            width: 120px;
            font-weight: 600;
            color: #555;
        }

        .probability-bar {
            flex: 1;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 0 10px;
        }

        .probability-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 10px;
            transition: width 0.5s ease;
        }

        .probability-value {
            width: 60px;
            text-align: right;
            font-weight: 600;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß† BrainWave Disorder Detection</h1>
            <p>Advanced EEG Signal Analysis using Deep Learning</p>
        </div>

        <div class="card">
            <h2 style="text-align: center; margin-bottom: 30px; color: #667eea;">Upload EEG Signal for Analysis</h2>
            
            <div class="input-section">
                <div class="input-group">
                    <label>Upload EEG Data File (CSV format):</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="fileInput" class="file-input" accept=".csv,.txt" />
                        <div class="file-input-button">
                            üìÅ Choose File or Drop Here
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Or Enter EEG Data Manually (178 values):</label>
                    <textarea id="manualInput" class="text-input" 
                              placeholder="Enter 178 comma-separated values representing EEG signal data points...&#10;Example: 4097.0, 4098.0, 4099.0, ..."></textarea>
                </div>
            </div>

            <div class="button-group">
                <button id="analyzeBtn" class="btn btn-primary">
                    üî¨ Analyze Signal
                </button>
                <button id="generateSampleBtn" class="btn btn-secondary">
                    üé≤ Generate Sample Data
                </button>
                <button id="clearBtn" class="btn btn-success">
                    üóëÔ∏è Clear All
                </button>
            </div>

            <div id="statusMessage"></div>
        </div>

        <div id="resultsSection" class="results-section" style="display: none;">
            <div class="prediction-card">
                <div class="prediction-title">Diagnosis Result</div>
                <div id="predictionResult" class="prediction-result">-</div>
                <div id="confidenceScore" class="confidence-score">Confidence: -</div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 20px; text-align: center;">Signal Visualization</h3>
                <div class="chart-container">
                    <canvas id="signalChart" class="signal-display"></canvas>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 20px; text-align: center;">Prediction Probabilities</h3>
                <div id="probabilityBars" class="probability-bars"></div>
            </div>
        </div>
    </div>

    <script>
        // EEG disorder classes
        const DISORDER_CLASSES = {
            1: { name: "Epileptic Seizure", color: "#ff4757", description: "Seizure activity detected" },
            2: { name: "Tumor Activity", color: "#ff6b35", description: "Potential tumor-related activity" },
            3: { name: "Healthy (Eyes Open)", color: "#26d0ce", description: "Normal brain activity, eyes open" },
            4: { name: "Healthy (Eyes Closed)", color: "#1dd1a1", description: "Normal brain activity, eyes closed" },
            5: { name: "Unknown Activity", color: "#feca57", description: "Unclassified brain activity" }
        };

        let signalChart = null;
        let currentData = null;

        // Initialize file input handler
        document.getElementById('fileInput').addEventListener('change', handleFileUpload);

        // Drag and drop functionality
        const fileInputButton = document.querySelector('.file-input-button');
        
        fileInputButton.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileInputButton.style.background = '#667eea';
            fileInputButton.style.color = 'white';
        });

        fileInputButton.addEventListener('dragleave', (e) => {
            e.preventDefault();
            fileInputButton.style.background = '#f8f9ff';
            fileInputButton.style.color = '#667eea';
        });

        fileInputButton.addEventListener('drop', (e) => {
            e.preventDefault();
            fileInputButton.style.background = '#f8f9ff';
            fileInputButton.style.color = '#667eea';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInputButton.addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });

        // Button event listeners
        document.getElementById('analyzeBtn').addEventListener('click', analyzeSignal);
        document.getElementById('generateSampleBtn').addEventListener('click', generateSampleData);
        document.getElementById('clearBtn').addEventListener('click', clearAll);

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            if (!file.name.toLowerCase().endsWith('.csv') && !file.name.toLowerCase().endsWith('.txt')) {
                showStatus('Please upload a CSV or TXT file.', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                parseFileContent(content);
            };
            reader.readAsText(file);
        }

        function parseFileContent(content) {
            try {
                // Try to parse as CSV data
                const lines = content.trim().split('\n');
                let data = [];

                if (lines.length === 1) {
                    // Single line of comma-separated values
                    data = lines[0].split(',').map(val => parseFloat(val.trim()));
                } else {
                    // Multiple lines, assume first column or last column contains the signal
                    for (let line of lines) {
                        const values = line.split(',');
                        if (values.length > 1) {
                            // Take all but last column (assuming last is label)
                            const signalValues = values.slice(0, -1).map(val => parseFloat(val.trim()));
                            data = data.concat(signalValues);
                        }
                    }
                }

                if (data.length === 0 || data.some(isNaN)) {
                    throw new Error('Invalid data format');
                }

                // Take first 178 values if more are available
                if (data.length > 178) {
                    data = data.slice(0, 178);
                    showStatus(`File loaded successfully. Using first 178 data points.`, 'success');
                } else if (data.length < 178) {
                    showStatus(`Warning: Only ${data.length} data points found. Need 178 for optimal analysis.`, 'info');
                } else {
                    showStatus('File loaded successfully!', 'success');
                }

                currentData = data;
                document.getElementById('manualInput').value = data.join(', ');
                
            } catch (error) {
                showStatus('Error parsing file. Please check the format.', 'error');
                console.error('File parsing error:', error);
            }
        }

        function generateSampleData() {
            // Generate realistic EEG-like sample data
            const sampleData = [];
            const baseValue = 4097;
            const time = [];
            
            for (let i = 0; i < 178; i++) {
                time.push(i);
                // Generate realistic EEG signal with multiple frequency components
                let value = baseValue;
                value += 50 * Math.sin(2 * Math.PI * 0.05 * i); // Slow wave
                value += 30 * Math.sin(2 * Math.PI * 0.1 * i);  // Alpha wave
                value += 20 * Math.sin(2 * Math.PI * 0.2 * i);  // Beta wave
                value += 10 * (Math.random() - 0.5);            // Noise
                
                sampleData.push(Math.round(value * 100) / 100);
            }
            
            currentData = sampleData;
            document.getElementById('manualInput').value = sampleData.join(', ');
            showStatus('Sample EEG data generated successfully!', 'success');
        }

        function analyzeSignal() {
            let data = currentData;
            
            // If no file data, try manual input
            if (!data) {
                const manualInput = document.getElementById('manualInput').value.trim();
                if (!manualInput) {
                    showStatus('Please upload a file or enter data manually.', 'error');
                    return;
                }
                
                try {
                    data = manualInput.split(',').map(val => parseFloat(val.trim()));
                    if (data.some(isNaN)) {
                        throw new Error('Invalid numbers in input');
                    }
                } catch (error) {
                    showStatus('Invalid data format. Please enter comma-separated numbers.', 'error');
                    return;
                }
            }

            if (data.length !== 178) {
                showStatus(`Warning: Expected 178 data points, got ${data.length}. Results may be less accurate.`, 'info');
                
                if (data.length < 178) {
                    // Pad with last value
                    while (data.length < 178) {
                        data.push(data[data.length - 1]);
                    }
                } else {
                    // Truncate
                    data = data.slice(0, 178);
                }
            }

            // Show loading state
            const analyzeBtn = document.getElementById('analyzeBtn');
            const originalText = analyzeBtn.innerHTML;
            analyzeBtn.innerHTML = '<span class="loading"></span> Analyzing...';
            analyzeBtn.disabled = true;

            // Simulate analysis (in real implementation, this would call your Python model)
            setTimeout(() => {
                const result = simulateModelPrediction(data);
                displayResults(result, data);
                
                analyzeBtn.innerHTML = originalText;
                analyzeBtn.disabled = false;
            }, 2000);
        }

        function simulateModelPrediction(data) {
            // This is a mock prediction - in reality, you'd call your trained model
            // The simulation analyzes signal characteristics to make a reasonable guess
            
            const mean = data.reduce((a, b) => a + b) / data.length;
            const variance = data.reduce((a, b) => a + Math.pow(b - mean, 2)) / data.length;
            const range = Math.max(...data) - Math.min(...data);
            
            // Simple heuristic classification based on signal characteristics
            let predictedClass;
            let confidence;
            
            if (variance > 2000 && range > 200) {
                predictedClass = 1; // Epileptic seizure (high variance, high range)
                confidence = 0.85 + Math.random() * 0.1;
            } else if (mean > 4200 && variance > 1000) {
                predictedClass = 2; // Tumor activity
                confidence = 0.75 + Math.random() * 0.15;
            } else if (mean > 4100 && variance < 500) {
                predictedClass = 3; // Healthy eyes open
                confidence = 0.80 + Math.random() * 0.15;
            } else if (mean > 4050 && variance < 800) {
                predictedClass = 4; // Healthy eyes closed
                confidence = 0.82 + Math.random() * 0.13;
            } else {
                predictedClass = 5; // Unknown
                confidence = 0.60 + Math.random() * 0.2;
            }

            // Generate probability distribution
            const probabilities = [0, 0, 0, 0, 0];
            probabilities[predictedClass - 1] = confidence;
            
            // Distribute remaining probability among other classes
            const remaining = 1 - confidence;
            for (let i = 0; i < 5; i++) {
                if (i !== predictedClass - 1) {
                    probabilities[i] = (remaining / 4) + (Math.random() - 0.5) * 0.1;
                }
            }

            // Normalize probabilities
            const sum = probabilities.reduce((a, b) => a + b);
            for (let i = 0; i < 5; i++) {
                probabilities[i] = Math.max(0, probabilities[i] / sum);
            }

            return {
                predictedClass,
                confidence,
                probabilities
            };
        }

        function displayResults(result, data) {
            const resultsSection = document.getElementById('resultsSection');
            const predictionResult = document.getElementById('predictionResult');
            const confidenceScore = document.getElementById('confidenceScore');

            const disorder = DISORDER_CLASSES[result.predictedClass];
            
            predictionResult.textContent = disorder.name;
            predictionResult.style.color = disorder.color;
            confidenceScore.textContent = `Confidence: ${(result.confidence * 100).toFixed(1)}%`;

            // Display signal chart
            displaySignalChart(data);
            
            // Display probability bars
            displayProbabilityBars(result.probabilities);

            resultsSection.style.display = 'block';
            resultsSection.scrollIntoView({ behavior: 'smooth' });

            showStatus(`Analysis complete! Detected: ${disorder.name}`, 'success');
        }

        function displaySignalChart(data) {
            const ctx = document.getElementById('signalChart').getContext('2d');
            
            if (signalChart) {
                signalChart.destroy();
            }

            const labels = Array.from({ length: data.length }, (_, i) => i);

            signalChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'EEG Signal',
                        data: data,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1,
                        pointRadius: 0,
                        pointHoverRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: 'EEG Signal Data Points'
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Time Points'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Amplitude'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        function displayProbabilityBars(probabilities) {
            const container = document.getElementById('probabilityBars');
            container.innerHTML = '';

            Object.keys(DISORDER_CLASSES).forEach((classNum, index) => {
                const disorder = DISORDER_CLASSES[classNum];
                const probability = probabilities[index];

                const item = document.createElement('div');
                item.className = 'probability-item';
                
                item.innerHTML = `
                    <div class="probability-label">${disorder.name}</div>
                    <div class="probability-bar">
                        <div class="probability-fill" style="width: ${probability * 100}%; background: ${disorder.color}"></div>
                    </div>
                    <div class="probability-value">${(probability * 100).toFixed(1)}%</div>
                `;
                
                container.appendChild(item);
            });
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
            
            setTimeout(() => {
                statusDiv.innerHTML = '';
            }, 5000);
        }

        function clearAll() {
            document.getElementById('fileInput').value = '';
            document.getElementById('manualInput').value = '';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('statusMessage').innerHTML = '';
            currentData = null;
            
            if (signalChart) {
                signalChart.destroy();
                signalChart = null;
            }
            
            showStatus('All data cleared.', 'info');
        }
    </script>
</body>
</html>